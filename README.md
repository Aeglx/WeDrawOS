# WeDraw - 模块化电商系统

## 项目简介
WeDraw是一个模块化设计的电商系统，提供完整的买家、卖家和管理员功能，同时集成了公众号和企业微信管理能力。系统采用前后端分离架构，支持多端访问和实时消息通信。

## 1. 系统模块总览

### 核心框架模块
- **数据访问层**：数据库交互和ORM映射
- **通用工具类**：包含加密、验证、环境、网络等工具
- **安全认证框架**：JWT身份验证和权限控制
- **异常处理机制**：统一的错误捕获和响应格式
- **数据校验组件**：请求参数验证和数据格式检查
- **缓存管理**：Redis缓存策略和缓存预热

### 公共API模块
- **接口文档**：通用业务组件**：跨模块共享的业务逻辑
- **消息队列定义**：系统间通信的消息格式规范
- **缓存配置**：缓存键设计和过期策略
- **公共服务接口**：跨模块调用的服务接口

### 买家端API
- **用户注册登录**：账号创建、登录认证、密码找回
- **商品浏览搜索**：分类浏览、关键词搜索、筛选排序
- **购物车管理**：添加、修改、删除购物车商品
- **订单创建支付**：订单生成、支付集成、订单状态跟踪
- **个人中心**：用户信息管理、收货地址管理
- **评价管理**：商品评价、评价回复

### 卖家端API
- **店铺管理**：店铺信息设置、店铺装修
- **商品发布管理**：商品上下架、库存管理、价格调整
- **订单处理**：订单审核、发货管理、退款处理
- **营销活动设置**：优惠券管理、促销活动配置
- **销售数据分析**：销量报表、流量分析、用户画像
- **财务结算**：账单查询、提现申请

### 管理端
- **系统设置**：基础参数配置、系统日志管理
- **用户管理**：用户账号、角色权限分配
- **权限控制**：功能权限、数据权限管理
- **数据统计**：系统运营数据看板
- **运营管理**：活动策划、资源位管理
- **内容管理**：公告、帮助中心、知识库
- **广告管理**：广告位配置、素材上传、投放管理
- **公众号管理**：
  - 账号信息配置
  - 用户管理与标签
  - 素材管理（图文、视频、语音等）
  - 模板消息管理
  - 订阅通知配置
  - 对话管理
  - 自定义菜单管理
- **企业微信管理**：
  - 外部群群发（支持向外部群通过群主发送消息）
  - 素材管理（图片、文本、链接等）
  - 消息发送统计（效果追踪分析）

### 管理员API
- **后台管理接口**：管理后台的数据操作接口
- **权限管理**：角色创建、权限分配、菜单配置
- **数据监控**：系统运行状态监控、性能指标
- **系统日志**：操作日志、错误日志、访问日志
- **公众号和企业微信相关接口**：管理平台的微信生态接口

### 消息消费者模块
- **订单消息**：订单状态变更、支付结果通知
- **商品消息**：库存预警、价格变动
- **会员消息**：会员等级变更、积分变动
- **通知消息**：系统通知、活动推送
- **售后服务消息**：退款进度、投诉处理

### 即时通讯API
- **消息推送**：实时消息推送、离线消息存储
- **在线客服**：客服会话、自动回复、会话转移
- **通知系统**：站内信、邮件、短信发送
- **WebSocket通信**：实时双向通信通道

### 定时任务模块
- **订单自动关闭**：超时未支付订单自动关闭
- **数据同步**：多系统间数据定期同步
- **统计报表生成**：销售报表、用户报表定时生成
- **缓存刷新**：热点数据缓存定时更新
- **定时任务调度**：基于cron表达式的任务调度

## 2. 功能权限说明

- **管理员端**：完全控制所有功能，包括完整的公众号和企业微信管理功能
- **卖家端**：仅可使用管理员授权的部分功能，无法直接使用公众号和企业微信内部功能
- **买家端**：仅可使用面向用户的购物和个人中心功能

## 3. 授权机制

管理员可以通过权限控制系统，为卖家分配特定的功能权限。卖家端可以访问这些被授权的功能，但不能直接操作公众号和企业微信的核心功能，只能通过平台提供的接口或模板进行有限的操作。

## 4. 端口配置

- **后端API服务**：3000
- **买家端应用**：4000
- **卖家端应用**：5000
- **管理端应用**：6000
- **数据库服务**：3306
- **Redis服务**：6379

## 5. 快速开始

### 环境要求

- Node.js >= 14.0.0
- MySQL >= 5.7
- Redis >= 6.0

### 安装步骤

1. **安装依赖**
   ```bash
   npm install
   ```

2. **配置环境变量**
   ```bash
   # 根据.env.example创建.env文件并配置相关参数
   # 数据库配置中user固定为root，password固定为123456，dbname固定为wedraw
   ```

3. **启动服务**
   ```bash
   # 开发模式
   npm run dev
   
   # 生产模式
   npm start
   ```

## 6. API文档

项目集成了Swagger UI，提供交互式API文档：

- **开发环境**：http://localhost:3000/api-docs
- **生产环境**：启动服务后通过配置的域名访问

## 7. 项目结构

```
├── src/
│   ├── admin/               # 管理端前端代码
│   ├── api/                 # 后端API代码
│   │   ├── app.js           # 应用主入口
│   │   ├── core/            # 核心模块
│   │   │   ├── di/          # 依赖注入容器
│   │   │   ├── data-access/ # 数据访问层
│   │   │   ├── cache/       # 缓存管理
│   │   │   ├── security/    # 安全相关
│   │   │   ├── utils/       # 工具类
│   │   │   └── exception/   # 异常处理
│   │   ├── common-api/      # 通用API模块
│   │   ├── buyer-api/       # 买家API模块
│   │   ├── seller-api/      # 卖家API模块
│   │   ├── admin-api/       # 管理员API模块
│   │   ├── im-api/          # 即时通讯API模块
│   │   ├── message-consumer/# 消息消费者模块
│   │   ├── scheduler/       # 定时任务模块
│   │   └── index.js         # API路由入口
│   └── buyer/               # 买家端前端代码
│       ├── common/          # 公共组件
│       ├── components/      # UI组件
│       ├── pages/           # 页面组件
│       ├── services/        # API服务
│       ├── static/          # 静态资源
│       ├── store/           # 状态管理
│       └── utils/           # 工具函数
├── .env                     # 环境变量配置
├── .env.example             # 环境变量示例
├── .gitignore               # Git忽略配置
├── README.md                # 项目文档
├── build.js                 # 构建脚本
├── package-lock.json        # 依赖锁定文件
├── package.json             # 项目配置
├── logs/                    # 日志目录
└── uploads/                 # 上传文件目录
```

## 8. 安全措施

- **JWT身份认证**：无状态认证，便于水平扩展
- **密码加密存储**：使用bcrypt算法加密
- **输入验证**：请求参数严格校验，防止注入攻击
- **SQL注入防护**：使用参数化查询，避免直接拼接SQL
- **XSS防护**：输出转义，防止跨站脚本攻击
- **CSRF防护**：请求来源验证，防止跨站请求伪造
- **接口权限控制**：基于角色的访问控制
- **敏感数据脱敏**：日志和响应中的敏感信息脱敏处理

## 9. 开发规范

- **代码规范**：遵循ESLint代码规范
- **模块化设计**：功能解耦，便于维护和扩展
- **依赖注入**：优先使用依赖注入模式，提高代码可测试性
- **错误处理**：统一的错误处理机制和响应格式
- **日志记录**：完善的日志记录，便于问题排查
- **单元测试**：编写单元测试，确保代码质量
- **文档完善**：关键功能和API必须有详细文档

## 10. 性能优化

- **数据库索引优化**：合理创建索引，提高查询效率
- **缓存策略**：热点数据缓存，减少数据库访问
- **异步处理**：非实时任务异步处理，提高系统响应速度
- **分页查询**：大数据量查询分页处理
- **资源压缩**：前端资源压缩，减少加载时间
- **CDN加速**：静态资源使用CDN分发

## 11. 故障处理

- **服务监控**：关键服务状态监控和报警
- **日志分析**：错误日志收集和分析
- **熔断机制**：服务故障自动熔断，防止级联失败
- **降级方案**：核心功能保障，非核心功能降级
- **数据备份**：定期数据备份，确保数据安全

## 12. 贡献指南

欢迎贡献代码和提出建议！请遵循以下流程：

1. Fork本仓库
2. 创建功能分支 (`git checkout -b feature/amazing-feature`)
3. 提交更改 (`git commit -m 'Add some amazing feature'`)
4. 推送到分支 (`git push origin feature/amazing-feature`)
5. 开启Pull Request

## 13. 许可证

本项目采用MIT许可证。详情请参阅LICENSE文件。

## 14. 联系方式

如有问题或建议，请通过以下方式联系我们：

- 项目地址：https://github.com/Aeglx/WeDrawOS.git
- 邮箱：[项目维护者邮箱]
- 官方文档：[文档地址]
